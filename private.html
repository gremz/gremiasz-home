<html>
<body>
  <script>
function privateMode(callback) {
  var is_private = false, db, ua = window.navigator.userAgent.toLowerCase(), ieMatch = /(?:msie|rv:)\s?([\d\.]+)/.exec(ua), edge = /edge/.exec(ua);
  if (window.webkitRequestFileSystem) {
    window.webkitRequestFileSystem(window.TEMPORARY, 1, function() {}, function(e) { is_private = true; });
  } else if (window.indexedDB && /firefox/.test(ua)) {
      db = window.indexedDB.open('test');
      db.onerror = function() { is_private = true }
  } else if ((ieMatch && parseInt(ieMatch[1], 10) >= 10) || (edge && edge[0] == "edge")) {
      try { !window.indexedDB && (is_private = true); } catch (e) { is_private = true; }
  } else if (window.localStorage && /safari/.test(ua)) {
      try { window.openDatabase(null, null, null, null); } catch (e) { is_private = true; }
      try { window.localStorage.setItem('test', 1); } catch (e) { is_private = true; }
      window.localStorage.removeItem('test');
  }


  retry(function () { return db ? db.readyState === 'done' : true }, function () {
    callback(is_private);
  });

  (function retry(pass) {
    // var currentTrial = 0, maxRetry = 50, interval = 10, isTimeout = false;
    var id = window.setInterval(function() {
      console.log('try #', pass);
      if (db ? db.readyState === 'done' : true) window.clearInterval(id); retry(pass);
      if (pass++ > 50) window.clearInterval(id); callback(is_private);
      }
    }, 10);
  })()
}
    
    
 privateMode(function(isPrivate) { document.body.innerHTML += isPrivate; });
</script>
</body>
 </html>